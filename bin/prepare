#!/bin/bash
# -*- mode: bash; tab-width: 2; -*-
# vim: ts=2 sw=2 ft=bash noet

# source the Nos framework
. /opt/nanobox/nos/common.sh

# initialize Nos with the original arguments
nos_init "$@"

# source common lib
. ${engine_lib_dir}/python.sh

nos_print_process_start "Installing packages"

# install python interpreter and virtual_env
install_runtime

# Create virtual environment in a directory
create_env

# Update PATH to include the virtual environment
nos_persist_evar "PATH" "$(nos_code_dir)/env/bin"

# install web server
install_gunicorn

# generate config files for gunicorn
create_gunicorn_conf

# run pip install
pip_install

exit 0
