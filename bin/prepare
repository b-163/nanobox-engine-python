#!/bin/bash
# -*- mode: bash; tab-width: 2; -*-
# vim: ts=2 sw=2 ft=bash noet

# source the Nos framework
. /opt/nos/common.sh

# initialize Nos with the original arguments
nos_init "$@"

# source common lib
. ${engine_lib_dir}/python.sh

nos_print_process_start "Installing packages"

# install python interpreter
python_install_runtime

# install pip package manager
# install_pip

# install python virtual environment
python_install_virtualenv

# install node.js for static assets
nodejs_install_runtime

# install bower via npm if Bower.json is found
nodejs_install_bower

python_create_env

# persist all environment variables 
nos_persist_evars

nos_persist_evar "PATH" "$(nos_live_dir)/env/bin"

# install web server
python_install_gunicorn

# generate config files for gunicorn
python_create_gunicorn_conf

# run pip install
python_pip_install

# run bower install if Bower.json is found
nodejs_bower_install

# persist the current node.js version in the cache
nodejs_set_runtime

exit 0
